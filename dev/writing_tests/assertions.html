<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Assertions - Grillon - User Guide</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../quickstart.html"><strong aria-hidden="true">2.</strong> Quickstart</a></li><li class="chapter-item expanded "><a href="../writing_tests/index.html"><strong aria-hidden="true">3.</strong> Writing tests</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../writing_tests/client_configuration.html"><strong aria-hidden="true">3.1.</strong> Client configuration</a></li><li class="chapter-item expanded "><a href="../writing_tests/requests.html"><strong aria-hidden="true">3.2.</strong> Requests</a></li><li class="chapter-item expanded "><a href="../writing_tests/assertions.html" class="active"><strong aria-hidden="true">3.3.</strong> Assertions</a></li></ol></li><li class="chapter-item expanded "><a href="../logs.html"><strong aria-hidden="true">4.</strong> Logs</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Grillon - User Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/theredfish/grillon" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="assertions"><a class="header" href="#assertions">Assertions</a></h1>
<p>Grillon provides domain-specific language per protocol and framework to make it natural to write
assertions.</p>
<p>An assertion is made up of:</p>
<ul>
<li>A part under test like <code>status</code>,</li>
<li>a predicate such as <code>is</code>, <code>is_not</code>,</li>
<li>and an expected value, for example <code>200</code>.</li>
</ul>
<p>The predicates of a specific part can handle different type parameters. For example if you want to
assert that a status code is 200, you can pass a <code>u16</code> or a <code>StatusCode</code>. This information is
described below in the types column.</p>
<h2 id="execution-order"><a class="header" href="#execution-order">Execution order</a></h2>
<p>Your assertions are executed sequentially and in a blocking fashion. Asynchronous executions are not
supported yet. With sequential runs, order matters, so if you want to fail early under specific
conditions, it's possible. Each assertion produces <a href="../logs.html">logs</a>.</p>
<h2 id="http-assertion-table"><a class="header" href="#http-assertion-table">HTTP assertion table</a></h2>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">part</th><th style="text-align: left">predicates</th><th style="text-align: left">types</th></tr></thead><tbody>
<tr><td style="text-align: left">headers</td><td style="text-align: left">is, is_not, contains, does_not_contain</td><td style="text-align: left">Vec&lt;(HeaderName, HeaderValue)&gt;, HeaderMap</td></tr>
<tr><td style="text-align: left">status</td><td style="text-align: left">is, is_not, is_between</td><td style="text-align: left">u16, StatusCode</td></tr>
<tr><td style="text-align: left">json_body</td><td style="text-align: left">is, is_not, schema</td><td style="text-align: left">String, &amp;str, Value, <code>json!</code>, PathBuf</td></tr>
<tr><td style="text-align: left">json_path</td><td style="text-align: left">is, is_not, schema, contains, does_not_contain</td><td style="text-align: left">String, &amp;str, Value, <code>json!</code>, PathBuf</td></tr>
<tr><td style="text-align: left">response_time</td><td style="text-align: left">is_less_than</td><td style="text-align: left">u64</td></tr>
</tbody></table>
</div>
<h3 id="note-about-json_path"><a class="header" href="#note-about-json_path">Note about <code>json_path</code></a></h3>
<p>Json path requires one more argument than other predicates because you have to provide a path. The
expected value should always be a valid json representation. To enforce this the provided value is always converted to
a <code>Value</code>.</p>
<p>Here is an example of a json path assertion, where we are testing the value under the path <code>$[0].id</code>.</p>
<pre><code class="language-rust">#[tokio::test]
async fn test_json_path() -&gt; Result&lt;()&gt; {
    Grillon::new(&quot;https://jsonplaceholder.typicode.com&quot;)?
        .get(&quot;posts?id=1&quot;)
        .assert()
        .await
        .json_path(&quot;$[0].id&quot;, is(json!(1)))
        .json_path(&quot;$[0].id&quot;, is(&quot;1&quot;));

    Ok(())
}</code></pre>
<h2 id="custom-assertions"><a class="header" href="#custom-assertions">Custom assertions</a></h2>
<p>You may need to create more complex assertions or have more control on what is executed as part
of an assertion. If so, the library provides a specific function, <code>assert_fn</code>, allowing you to write
your own logic.</p>
<pre><code class="language-rust">Grillon::new(&quot;https://jsonplaceholder.typicode.com&quot;)?
    .post(&quot;posts&quot;)
    .payload(json!({
        &quot;title&quot;: &quot;foo&quot;,
        &quot;body&quot;: &quot;bar&quot;,
        &quot;userId&quot;: 1
    }))
    .assert()
    .await
    .status(is_success())
    .assert_fn(|assert| {
        assert!(!assert.headers.is_empty());
        assert!(assert.status == StatusCode::CREATED);
        assert!(assert.json.is_some());

        println!(&quot;Json response : {:#?}&quot;, assert.json);
    });</code></pre>
<p>With this function you can access the <code>Assert</code> structure which is the internal representation of an
http response under test. You should have access to all parts that Grillon supports (headers, status, json, etc.). It's also
possible to add your own stdout logs if you want more control over the results or need to debug
what you receive.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../writing_tests/requests.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../logs.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../writing_tests/requests.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../logs.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
